<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Men√∫s</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-slate-100 min-h-screen pb-20">

    <div class="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">üìù Editor Maestro de Men√∫s</h1>
            <button onclick="descargarArchivo()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition shadow-lg flex items-center gap-2">
                üíæ Descargar nuevo menus.js
            </button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-8">
        
        <div class="mb-8 bg-white p-6 rounded-xl shadow-sm">
            <label class="block text-sm font-bold text-gray-700 mb-2">Selecciona la Semana a Editar:</label>
            <select id="selector-semana" onchange="cargarSemana()" class="w-full p-3 border rounded-lg bg-gray-50 text-lg font-semibold outline-none focus:ring-2 focus:ring-blue-500">
                </select>
        </div>

        <div id="contenedor-dias" class="grid grid-cols-1 xl:grid-cols-2 gap-8">
            </div>

    </div>

    <script src="menus.js"></script>

    <script>
        // Referencias globales
        let datosGlobales = []; 
        
        // Al iniciar
        window.onload = function() {
            if (typeof coleccionMenus !== 'undefined') {
                // Hacemos una copia profunda para no romper nada hasta guardar
                datosGlobales = JSON.parse(JSON.stringify(coleccionMenus));
                inicializarSelector();
                cargarSemana();
            } else {
                alert("Error: No se encuentra menus.js");
            }
        };

        function inicializarSelector() {
            const selector = document.getElementById('selector-semana');
            selector.innerHTML = "";
            datosGlobales.forEach((menu, index) => {
                const opt = document.createElement('option');
                opt.value = index;
                opt.text = menu.nombre;
                selector.appendChild(opt);
            });
        }

        function cargarSemana() {
            const index = document.getElementById('selector-semana').value;
            const menuActual = datosGlobales[index];
            const contenedor = document.getElementById('contenedor-dias');
            contenedor.innerHTML = "";

            menuActual.semana.forEach((diaObj, diaIndex) => {
                const htmlDia = `
                <div class="bg-white p-6 rounded-2xl shadow border border-slate-200">
                    <h3 class="text-xl font-bold text-slate-800 mb-4 border-b pb-2">${diaObj.dia}</h3>
                    
                    <div class="space-y-4">
                        ${crearInput(index, diaIndex, 'segundoDesayuno', 'Segundo Desayuno', diaObj.comidas.segundoDesayuno)}
                        ${crearInput(index, diaIndex, 'almuerzo', 'Almuerzo', diaObj.comidas.almuerzo)}
                        ${crearInput(index, diaIndex, 'merienda', 'Merienda', diaObj.comidas.merienda)}
                        ${crearInput(index, diaIndex, 'cena', 'Cena', diaObj.comidas.cena)}
                    </div>
                </div>
                `;
                contenedor.innerHTML += htmlDia;
            });
        }

        function crearInput(menuIdx, diaIdx, tipoComida, label, valores) {
            // Convertimos el array ["Plato 1", "Plato 2"] a texto con saltos de l√≠nea para el textarea
            const textoValor = Array.isArray(valores) ? valores.join('\n') : valores;

            return `
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-1">${label}</label>
                    <textarea 
                        oninput="actualizarDato(${menuIdx}, ${diaIdx}, '${tipoComida}', this.value)"
                        class="w-full p-2 border rounded bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-400 outline-none text-sm min-h-[80px]"
                        placeholder="Escribe cada plato en una l√≠nea nueva..."
                    >${textoValor}</textarea>
                </div>
            `;
        }

        // FUNCI√ìN QUE GUARDA EN MEMORIA MIENTRAS ESCRIBES
        function actualizarDato(menuIdx, diaIdx, tipoComida, nuevoValor) {
            // Convertimos el texto del textarea (separado por enter) a Array
            const arrayPlatos = nuevoValor.split('\n').filter(linea => linea.trim() !== "");
            
            // Guardamos en la variable global
            datosGlobales[menuIdx].semana[diaIdx].comidas[tipoComida] = arrayPlatos;
        }

        // FUNCI√ìN DE DESCARGA
        function descargarArchivo() {
            // 1. Convertimos el objeto a texto con formato bonito
            const jsonString = JSON.stringify(datosGlobales, null, 4);
            
            // 2. Le a√±adimos el "const coleccionMenus =" del principio para que sea JS v√°lido
            // Y limpiamos las comillas de las claves para que quede profesional
            let contenidoJS = "const coleccionMenus = " + jsonString + ";";
            
            // Truco para quitar comillas de las claves (opcional, pero queda mejor)
            contenidoJS = contenidoJS.replace(/"(\w+)":/g, '$1:');

            // 3. Crear un "blob" (archivo virtual)
            const blob = new Blob([contenidoJS], { type: "text/javascript" });
            const url = URL.createObjectURL(blob);
            
            // 4. Forzar descarga
            const a = document.createElement('a');
            a.href = url;
            a.download = "menus.js";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            alert("‚úÖ Archivo descargado. Ahora reemplaza tu antiguo 'menus.js' con este nuevo.");
        }
    </script>
</body>
</html>